<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TreeTalk - Converse with Your Family History</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/family-chart@1.0.0/dist/index.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #ffffff;
            color: #262730;
        }
        
        /* Global Navigation */
        .navbar {
            background-color: #ff4b4b;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-title {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0;
            background-color: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 4px;
        }
        
        .nav-tab {
            flex: 1;
            padding: 0.5rem 1rem;
            background-color: transparent;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }
        
        .nav-tab:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .nav-tab.active {
            background-color: white;
            color: #ff4b4b;
        }
        
        /* Main Content */
        .main-content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Data Exploration Page */
        .gedcom-selector {
            margin-bottom: 2rem;
        }
        
        .gedcom-selector select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #f0f2f6;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .search-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #f0f2f6;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .person-item {
            padding: 0.5rem;
            border-bottom: 1px solid #e1e5e9;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .person-item:hover {
            background-color: #f0f2f6;
        }
        
        .visualization-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            min-height: 400px;
            position: relative;
        }
        
        /* Family Chart Container */
        #family-chart-container {
            width: 100%;
            height: 350px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e1e5e9;
            overflow: hidden;
        }
        
        /* D3.js Family Chart Styling */
        .family-chart {
            width: 100%;
            height: 100%;
        }
        
        .family-chart .node {
            cursor: pointer;
        }
        
        .family-chart .node circle {
            stroke-width: 2px;
        }
        
        .family-chart .node.male circle {
            fill: #007bff;
            stroke: #0056b3;
        }
        
        .family-chart .node.female circle {
            fill: #e91e63;
            stroke: #c2185b;
        }
        
        .family-chart .node.unknown circle {
            fill: #28a745;
            stroke: #1e7e34;
        }
        
        .family-chart .node text {
            fill: white;
            font-size: 10px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: central;
        }
        
        .family-chart .link {
            fill: none;
            stroke: #999;
            stroke-width: 1px;
        }
        
        .family-chart .link.marriage {
            stroke: #ff4b4b;
            stroke-width: 2px;
        }
        
        /* Chat Section */
        .chat-section {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid #e1e5e9;
            background: #ff4b4b;
            color: white;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            max-width: 80%;
        }
        
        .chat-message.user {
            background-color: #007bff;
            color: white;
            margin-left: auto;
        }
        
        .chat-message.assistant {
            background-color: white;
            border: 1px solid #e1e5e9;
        }
        
        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e1e5e9;
            display: flex;
            gap: 0.5rem;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #f0f2f6;
            border-radius: 6px;
            resize: none;
        }
        
        .chat-send-btn {
            padding: 0.75rem 1.5rem;
            background-color: #ff4b4b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        /* Configuration Page */
        .config-form {
            max-width: 600px;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #f0f2f6;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: #ff4b4b;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        /* GEDCOM Management Page */
        .upload-section {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .file-input {
            margin: 1rem 0;
        }
        
        .files-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .files-table th,
        .files-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }
        
        .files-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .status-success {
            color: #28a745;
            font-weight: 500;
        }
        
        .status-error {
            color: #dc3545;
            font-weight: 500;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #262730;
        }
    </style>
</head>
<body>
    <!-- Global Navigation -->
    <nav class="navbar">
        <div class="nav-title">ðŸŒ³ TreeTalk</div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('data-exploration')">Data Exploration</button>
            <button class="nav-tab" onclick="showPage('configuration')">Configuration</button>
            <button class="nav-tab" onclick="showPage('gedcom-management')">GEDCOM Management</button>
        </div>
    </nav>

    <div class="main-content">
        <!-- Data Exploration Page -->
        <div id="data-exploration" class="page active">
            <h2 class="section-title">Data Exploration</h2>
            
            <!-- GEDCOM Selector -->
            <div class="gedcom-selector">
                <label for="gedcom-select" class="form-label">Select GEDCOM Dataset:</label>
                <select id="gedcom-select" class="form-input">
                    <option value="">Choose a dataset...</option>
                    <option value="family1">Smith Family Tree (2,847 persons)</option>
                    <option value="family2">Johnson Lineage (1,203 persons)</option>
                </select>
            </div>

            <!-- Search and Visualization Grid -->
            <div class="content-grid">
                <!-- Family Members Search -->
                <div class="search-section">
                    <h3>Family Members - Search & Select</h3>
                    <input type="text" class="search-input" placeholder="Search by person name...">
                    <div class="search-results">
                        <div class="person-item">John Smith (1850-1920)</div>
                        <div class="person-item">Mary Johnson (1855-1925)</div>
                        <div class="person-item">Robert Smith (1820-1890)</div>
                        <div class="person-item">Elizabeth Wilson (1825-1895)</div>
                    </div>
                </div>

                <!-- Family Tree Visualization -->
                <div class="visualization-section">
                    <h3>Family Tree Visualization (4 degrees)</h3>
                    <div id="family-chart-container"></div>
                </div>
            </div>

            <!-- Chat Section -->
            <div class="chat-section">
                <div class="chat-header">
                    ðŸ’¬ Chat with Your Family History
                </div>
                <div class="chat-messages">
                    <div class="chat-message assistant">
                        Hello! I'm here to help you explore your family history. Ask me anything about your ancestors!
                    </div>
                    <div class="chat-message user">
                        Tell me about John Smith's children
                    </div>
                    <div class="chat-message assistant">
                        Based on your family data, John Smith (1850-1920) had 3 children:<br><br>
                        â€¢ William Smith (born 1875)<br>
                        â€¢ Sarah Smith (born 1878)<br>
                        â€¢ Thomas Smith (born 1882)<br><br>
                        Would you like to know more about any of these descendants?
                    </div>
                </div>
                <div class="chat-input-container">
                    <textarea class="chat-input" placeholder="Ask about your family history..." rows="2"></textarea>
                    <button class="chat-send-btn">Send</button>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div id="configuration" class="page">
            <h2 class="section-title">Configuration</h2>
            
            <form class="config-form">
                <div class="form-group">
                    <label for="api-key" class="form-label">OpenRouter API Key</label>
                    <input type="password" id="api-key" class="form-input" placeholder="Enter your OpenRouter API key...">
                </div>
                
                <div class="form-group">
                    <label for="model-select" class="form-label">Chat Model Selection</label>
                    <select id="model-select" class="form-input">
                        <option value="">Select a model...</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Free - $0.002/1K tokens)</option>
                        <option value="gpt-4">GPT-4 ($0.03/1K tokens)</option>
                        <option value="claude-3-haiku">Claude 3 Haiku ($0.0015/1K tokens)</option>
                        <option value="claude-3-sonnet">Claude 3 Sonnet ($0.015/1K tokens)</option>
                        <option value="llama-2-70b">Llama 2 70B (Free - $0.001/1K tokens)</option>
                    </select>
                </div>
                
                <button type="button" class="btn-primary">Save Configuration</button>
            </form>
        </div>

        <!-- GEDCOM Management Page -->
        <div id="gedcom-management" class="page">
            <h2 class="section-title">GEDCOM File Management</h2>
            
            <!-- Upload Section -->
            <div class="upload-section">
                <h3>Upload New GEDCOM File</h3>
                <p>Select a .ged file to import your family tree data</p>
                <div class="file-input">
                    <input type="file" accept=".ged" id="gedcom-upload">
                </div>
                <button type="button" class="btn-primary">Upload & Process</button>
            </div>

            <!-- Files List -->
            <div class="files-section">
                <h3>Uploaded GEDCOM Files</h3>
                <table class="files-table">
                    <thead>
                        <tr>
                            <th>Filename</th>
                            <th>Size</th>
                            <th>Upload Date</th>
                            <th>Status</th>
                            <th>Persons</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>smith_family_tree.ged</td>
                            <td>2.3 MB</td>
                            <td>2024-09-01 14:30</td>
                            <td><span class="status-success">Processed</span></td>
                            <td>2,847</td>
                            <td><button class="btn-danger">Delete</button></td>
                        </tr>
                        <tr>
                            <td>johnson_lineage.ged</td>
                            <td>1.1 MB</td>
                            <td>2024-09-02 09:15</td>
                            <td><span class="status-success">Processed</span></td>
                            <td>1,203</td>
                            <td><button class="btn-danger">Delete</button></td>
                        </tr>
                        <tr>
                            <td>wilson_ancestors.ged</td>
                            <td>800 KB</td>
                            <td>2024-09-03 16:45</td>
                            <td><span class="status-error">Error: Invalid format</span></td>
                            <td>0</td>
                            <td><button class="btn-danger">Delete</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Set active tab
            event.target.classList.add('active');
        }

        // Family Tree Data (Mock data for 4 degrees of relationships)
        const familyData = {
            nodes: [
                // Central person
                { id: 'john-smith', name: 'John Smith', gender: 'M', birth: '1850', death: '1920', generation: 0 },
                
                // Parents (Generation -1)
                { id: 'robert-smith', name: 'Robert Smith', gender: 'M', birth: '1820', death: '1890', generation: -1 },
                { id: 'elizabeth-wilson', name: 'Elizabeth Wilson', gender: 'F', birth: '1825', death: '1895', generation: -1 },
                
                // Grandparents (Generation -2)
                { id: 'james-smith', name: 'James Smith', gender: 'M', birth: '1795', death: '1870', generation: -2 },
                { id: 'sarah-jones', name: 'Sarah Jones', gender: 'F', birth: '1800', death: '1875', generation: -2 },
                { id: 'william-wilson', name: 'William Wilson', gender: 'M', birth: '1800', death: '1880', generation: -2 },
                { id: 'margaret-brown', name: 'Margaret Brown', gender: 'F', birth: '1805', death: '1885', generation: -2 },
                
                // Children (Generation +1)
                { id: 'william-smith-jr', name: 'William Smith Jr.', gender: 'M', birth: '1875', death: '1950', generation: 1 },
                { id: 'sarah-smith', name: 'Sarah Smith', gender: 'F', birth: '1878', death: '1955', generation: 1 },
                { id: 'thomas-smith', name: 'Thomas Smith', gender: 'M', birth: '1882', death: '1960', generation: 1 },
                
                // Spouse
                { id: 'mary-johnson', name: 'Mary Johnson', gender: 'F', birth: '1855', death: '1925', generation: 0 }
            ],
            links: [
                // Parent-child relationships
                { source: 'robert-smith', target: 'john-smith', type: 'parent' },
                { source: 'elizabeth-wilson', target: 'john-smith', type: 'parent' },
                { source: 'james-smith', target: 'robert-smith', type: 'parent' },
                { source: 'sarah-jones', target: 'robert-smith', type: 'parent' },
                { source: 'william-wilson', target: 'elizabeth-wilson', type: 'parent' },
                { source: 'margaret-brown', target: 'elizabeth-wilson', type: 'parent' },
                { source: 'john-smith', target: 'william-smith-jr', type: 'parent' },
                { source: 'john-smith', target: 'sarah-smith', type: 'parent' },
                { source: 'john-smith', target: 'thomas-smith', type: 'parent' },
                { source: 'mary-johnson', target: 'william-smith-jr', type: 'parent' },
                { source: 'mary-johnson', target: 'sarah-smith', type: 'parent' },
                { source: 'mary-johnson', target: 'thomas-smith', type: 'parent' },
                
                // Marriage relationships
                { source: 'john-smith', target: 'mary-johnson', type: 'marriage' },
                { source: 'robert-smith', target: 'elizabeth-wilson', type: 'marriage' },
                { source: 'james-smith', target: 'sarah-jones', type: 'marriage' },
                { source: 'william-wilson', target: 'margaret-brown', type: 'marriage' }
            ]
        };

        function initializeFamilyChart() {
            const container = d3.select('#family-chart-container');
            const width = 600;
            const height = 350;
            
            // Clear any existing chart
            container.selectAll('*').remove();
            
            const svg = container.append('svg')
                .attr('class', 'family-chart')
                .attr('width', width)
                .attr('height', height);
            
            // Create force simulation
            const simulation = d3.forceSimulation(familyData.nodes)
                .force('link', d3.forceLink(familyData.links).id(d => d.id).distance(80))
                .force('charge', d3.forceManyBody().strength(-200))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('y', d3.forceY().y(d => height / 2 + d.generation * 60).strength(0.5));
            
            // Create links
            const link = svg.append('g')
                .selectAll('line')
                .data(familyData.links)
                .enter()
                .append('line')
                .attr('class', d => `link ${d.type}`)
                .attr('stroke-width', d => d.type === 'marriage' ? 3 : 1);
            
            // Create nodes
            const node = svg.append('g')
                .selectAll('g')
                .data(familyData.nodes)
                .enter()
                .append('g')
                .attr('class', d => `node ${d.gender === 'M' ? 'male' : d.gender === 'F' ? 'female' : 'unknown'}`)
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));
            
            // Add circles to nodes
            node.append('circle')
                .attr('r', 25)
                .on('click', function(event, d) {
                    console.log('Selected person:', d.name);
                    // Update focused person
                    updateFocusedPerson(d);
                });
            
            // Add text to nodes
            node.append('text')
                .text(d => {
                    const names = d.name.split(' ');
                    return names[0]; // First name only for space
                })
                .style('font-size', '10px')
                .style('font-weight', 'bold')
                .style('fill', 'white')
                .style('text-anchor', 'middle')
                .style('dominant-baseline', 'central');
            
            // Add tooltips
            node.append('title')
                .text(d => `${d.name}\n(${d.birth} - ${d.death || 'present'})`);
            
            // Update positions on simulation tick
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node
                    .attr('transform', d => `translate(${d.x}, ${d.y})`);
            });
            
            // Drag functions
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }
        
        function updateFocusedPerson(person) {
            // This would typically update the chat context and other UI elements
            console.log('Focused person updated to:', person.name);
            
            // Example: Update a status indicator
            const statusElement = document.querySelector('.focused-person-status');
            if (statusElement) {
                statusElement.textContent = `Focused on: ${person.name}`;
            }
        }

        // Mock functionality for demonstration
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the family chart
            initializeFamilyChart();
            
            // Search functionality
            const searchInput = document.querySelector('.search-input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    console.log('Searching for:', this.value);
                });
            }
            
            // Person item clicks
            const personItems = document.querySelectorAll('.person-item');
            personItems.forEach(item => {
                item.addEventListener('click', function() {
                    const personName = this.textContent.trim();
                    console.log('Selected person from search:', personName);
                    
                    // Find corresponding person in family data and update chart focus
                    const person = familyData.nodes.find(n => this.textContent.includes(n.name));
                    if (person) {
                        updateFocusedPerson(person);
                    }
                });
            });
            
            // Chat send button
            const chatSendBtn = document.querySelector('.chat-send-btn');
            const chatInput = document.querySelector('.chat-input');
            if (chatSendBtn && chatInput) {
                chatSendBtn.addEventListener('click', function() {
                    const message = chatInput.value.trim();
                    if (message) {
                        console.log('Sending message:', message);
                        chatInput.value = '';
                    }
                });
            }
            
            // GEDCOM selector change
            const gedcomSelect = document.querySelector('#gedcom-select');
            if (gedcomSelect) {
                gedcomSelect.addEventListener('change', function() {
                    console.log('Selected GEDCOM:', this.value);
                    // Reinitialize chart with new data
                    if (this.value) {
                        initializeFamilyChart();
                    }
                });
            }
        });
    </script>
</body>
</html>